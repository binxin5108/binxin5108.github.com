<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring Bean生命周期 | zhoubg&#39;s blog</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/img/favicon.ico">
    <script data-ad-client="ca-pub-7828333725993554" async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <meta name="description" content="后端技术博客,专注后端技术学习与总结。Java,Spring,SpringMVC,SpringBoot,Mybatis,Mysql,Redis,tomcat等技术文章。">
    <meta name="keywords" content="后端博客,个人技术博客,后端,后端开发,后端框架,技术文档,学习,笔记,Java,Spring,SpringMVC,SpringBoot,Mybatis,Mysql,Redis,Tomcat,Nginx">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.9b6d4191.css" as="style"><link rel="preload" href="/assets/js/app.22150bd5.js" as="script"><link rel="preload" href="/assets/js/2.032d6d47.js" as="script"><link rel="preload" href="/assets/js/73.483dda2c.js" as="script"><link rel="prefetch" href="/assets/js/10.da9b177d.js"><link rel="prefetch" href="/assets/js/11.38b6519d.js"><link rel="prefetch" href="/assets/js/12.71582a98.js"><link rel="prefetch" href="/assets/js/13.8e2c1cdd.js"><link rel="prefetch" href="/assets/js/14.3844f939.js"><link rel="prefetch" href="/assets/js/15.24ce5872.js"><link rel="prefetch" href="/assets/js/16.e9c8da96.js"><link rel="prefetch" href="/assets/js/17.eff2b5e1.js"><link rel="prefetch" href="/assets/js/18.6fdd68d0.js"><link rel="prefetch" href="/assets/js/19.5680e42b.js"><link rel="prefetch" href="/assets/js/20.d3123d34.js"><link rel="prefetch" href="/assets/js/21.8b36dffe.js"><link rel="prefetch" href="/assets/js/22.76994839.js"><link rel="prefetch" href="/assets/js/23.00ad3785.js"><link rel="prefetch" href="/assets/js/24.344ceddf.js"><link rel="prefetch" href="/assets/js/25.a95b641f.js"><link rel="prefetch" href="/assets/js/26.5641c4bf.js"><link rel="prefetch" href="/assets/js/27.c675e9f8.js"><link rel="prefetch" href="/assets/js/28.11cbd236.js"><link rel="prefetch" href="/assets/js/29.887297cb.js"><link rel="prefetch" href="/assets/js/3.a13580e4.js"><link rel="prefetch" href="/assets/js/30.c6173a68.js"><link rel="prefetch" href="/assets/js/31.41134e6f.js"><link rel="prefetch" href="/assets/js/32.aec2a6c9.js"><link rel="prefetch" href="/assets/js/33.5262a15c.js"><link rel="prefetch" href="/assets/js/34.595fafe5.js"><link rel="prefetch" href="/assets/js/35.b0d01154.js"><link rel="prefetch" href="/assets/js/36.5af546b8.js"><link rel="prefetch" href="/assets/js/37.df1f1a3b.js"><link rel="prefetch" href="/assets/js/38.3db59c44.js"><link rel="prefetch" href="/assets/js/39.aaad77d4.js"><link rel="prefetch" href="/assets/js/4.175611c0.js"><link rel="prefetch" href="/assets/js/40.a70a6235.js"><link rel="prefetch" href="/assets/js/41.64a198b3.js"><link rel="prefetch" href="/assets/js/42.a759a582.js"><link rel="prefetch" href="/assets/js/43.96662edf.js"><link rel="prefetch" href="/assets/js/44.6284fa3d.js"><link rel="prefetch" href="/assets/js/45.15732445.js"><link rel="prefetch" href="/assets/js/46.aa45e361.js"><link rel="prefetch" href="/assets/js/47.618c26ae.js"><link rel="prefetch" href="/assets/js/48.a20c445a.js"><link rel="prefetch" href="/assets/js/49.4e412f92.js"><link rel="prefetch" href="/assets/js/5.284fd435.js"><link rel="prefetch" href="/assets/js/50.a07968c8.js"><link rel="prefetch" href="/assets/js/51.a308fe2c.js"><link rel="prefetch" href="/assets/js/52.1c526319.js"><link rel="prefetch" href="/assets/js/53.2cac5d0c.js"><link rel="prefetch" href="/assets/js/54.6ef4bb5c.js"><link rel="prefetch" href="/assets/js/55.ac01f11f.js"><link rel="prefetch" href="/assets/js/56.f5a50f22.js"><link rel="prefetch" href="/assets/js/57.1e862d73.js"><link rel="prefetch" href="/assets/js/58.fa00c6a3.js"><link rel="prefetch" href="/assets/js/59.e858b141.js"><link rel="prefetch" href="/assets/js/6.b884029a.js"><link rel="prefetch" href="/assets/js/60.7472f56c.js"><link rel="prefetch" href="/assets/js/61.8a0b41cf.js"><link rel="prefetch" href="/assets/js/62.984b15e5.js"><link rel="prefetch" href="/assets/js/63.5c831fdc.js"><link rel="prefetch" href="/assets/js/64.46e8aa64.js"><link rel="prefetch" href="/assets/js/65.4cc70a83.js"><link rel="prefetch" href="/assets/js/66.2a027463.js"><link rel="prefetch" href="/assets/js/67.33eac060.js"><link rel="prefetch" href="/assets/js/68.234fd8e9.js"><link rel="prefetch" href="/assets/js/69.28f1723b.js"><link rel="prefetch" href="/assets/js/7.3da41d04.js"><link rel="prefetch" href="/assets/js/70.22d54301.js"><link rel="prefetch" href="/assets/js/71.7ca61576.js"><link rel="prefetch" href="/assets/js/72.b6595dff.js"><link rel="prefetch" href="/assets/js/74.21a795a7.js"><link rel="prefetch" href="/assets/js/75.68ef4daa.js"><link rel="prefetch" href="/assets/js/76.5d5c2eab.js"><link rel="prefetch" href="/assets/js/8.e5568450.js"><link rel="prefetch" href="/assets/js/9.80bb0997.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9b6d4191.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="zhoubg's blog" class="logo"> <span class="site-name can-hide">zhoubg's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/backend/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/spring/" class="nav-link">Spring 学习笔记</a></li><li class="dropdown-subitem"><a href="/note/mybatis/" class="nav-link">Mybatis 学习笔记</a></li><li class="dropdown-subitem"><a href="/note/mysql/" class="nav-link">Mysql 学习笔记</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/database/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">Mysql</a></li><li class="dropdown-item"><!----> <a href="/pages/c8f128/" class="nav-link">Redis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="云原生" class="dropdown-title"><a href="/cloudnative/" class="link-title">云原生</a> <span class="title" style="display:none;">云原生</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/0073e8/" class="nav-link">docker</a></li><li class="dropdown-item"><!----> <a href="/pages/203b72/" class="nav-link">k8s</a></li><li class="dropdown-item"><!----> <a href="/pages/3ebd53/" class="nav-link">kebesphere</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="收藏" class="dropdown-title"><a href="/pages/site_collect/" class="link-title">收藏</a> <span class="title" style="display:none;">收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/site_collect/" class="nav-link">网站</a></li><li class="dropdown-item"><!----> <a href="/pages/front_tool/" class="nav-link">前端工具</a></li><li class="dropdown-item"><!----> <a href="/pages/back_tool/" class="nav-link">后端工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/xugaoyi/image_store/blog/20200103123203.jpg"> <div class="blogger-info"><h3>zhoubg</h3> <span>这里有枚小技术</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/backend/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/spring/" class="nav-link">Spring 学习笔记</a></li><li class="dropdown-subitem"><a href="/note/mybatis/" class="nav-link">Mybatis 学习笔记</a></li><li class="dropdown-subitem"><a href="/note/mysql/" class="nav-link">Mysql 学习笔记</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/database/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">Mysql</a></li><li class="dropdown-item"><!----> <a href="/pages/c8f128/" class="nav-link">Redis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="云原生" class="dropdown-title"><a href="/cloudnative/" class="link-title">云原生</a> <span class="title" style="display:none;">云原生</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/0073e8/" class="nav-link">docker</a></li><li class="dropdown-item"><!----> <a href="/pages/203b72/" class="nav-link">k8s</a></li><li class="dropdown-item"><!----> <a href="/pages/3ebd53/" class="nav-link">kebesphere</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="收藏" class="dropdown-title"><a href="/pages/site_collect/" class="link-title">收藏</a> <span class="title" style="display:none;">收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/site_collect/" class="nav-link">网站</a></li><li class="dropdown-item"><!----> <a href="/pages/front_tool/" class="nav-link">前端工具</a></li><li class="dropdown-item"><!----> <a href="/pages/back_tool/" class="nav-link">后端工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/pages/0796ba76b4b55368/" class="sidebar-link">Spring总览</a></li><li><a href="/pages/74d2ab3fbfeaaa68/" class="sidebar-link">重新认识IoC</a></li><li><a href="/pages/659b5af5e2e704e0/" class="sidebar-link">Spring IoC 容器概述</a></li><li><a href="/pages/5e44ae/" class="sidebar-link">Spring Bean基础</a></li><li><a href="/pages/c77684/" class="sidebar-link">Spring 依赖查找</a></li><li><a href="/pages/29aefb/" class="sidebar-link">Spring 依赖注入</a></li><li><a href="/pages/de9416/" class="sidebar-link">Spring IoC依赖来源</a></li><li><a href="/pages/742851/" class="sidebar-link">Spring Bean作用域</a></li><li><a href="/pages/69532e/" aria-current="page" class="active sidebar-link">Spring Bean生命周期</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/69532e/#一、spring-bean元信息配置和解析阶段" class="sidebar-link">一、Spring Bean元信息配置和解析阶段</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/69532e/#_1、spring-bean元信息配置" class="sidebar-link">1、Spring Bean元信息配置</a></li><li class="sidebar-sub-header level3"><a href="/pages/69532e/#_2、spring-bean元信息解析" class="sidebar-link">2、Spring Bean元信息解析</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/69532e/#二、spring-bean注册阶段" class="sidebar-link">二、Spring Bean注册阶段</a></li><li class="sidebar-sub-header level2"><a href="/pages/69532e/#三、spring-beandefinition-合并阶段" class="sidebar-link">三、Spring BeanDefinition 合并阶段</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/69532e/#_1、mergedbeandefinition-什么时候进行" class="sidebar-link">1、MergedBeanDefinition 什么时候进行?</a></li><li class="sidebar-sub-header level3"><a href="/pages/69532e/#_2、mergedbeandefinition-合并过程" class="sidebar-link">2、MergedBeanDefinition 合并过程</a></li><li class="sidebar-sub-header level3"><a href="/pages/69532e/#_3、mergedbeandefinition的应用" class="sidebar-link">3、MergedBeanDefinition的应用</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/69532e/#四、spring-bean-class-加载阶段" class="sidebar-link">四、Spring Bean Class 加载阶段</a></li><li class="sidebar-sub-header level2"><a href="/pages/69532e/#五、spring-bean实例化阶段" class="sidebar-link">五、Spring Bean实例化阶段</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/69532e/#_1、spring-bean实例化前阶段" class="sidebar-link">1、Spring Bean实例化前阶段</a></li><li class="sidebar-sub-header level3"><a href="/pages/69532e/#_2、spring-bean实例化阶段" class="sidebar-link">2、Spring Bean实例化阶段</a></li><li class="sidebar-sub-header level3"><a href="/pages/69532e/#_3、spring-bean实例化后阶段" class="sidebar-link">3、Spring Bean实例化后阶段</a></li><li class="sidebar-sub-header level3"><a href="/pages/69532e/#" class="sidebar-link"></a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/69532e/#六、spring-bean属性赋值阶段" class="sidebar-link">六、Spring Bean属性赋值阶段</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/69532e/#_1、赋值前回调阶段-postprocessproperties" class="sidebar-link">1、赋值前回调阶段 - postProcessProperties</a></li><li class="sidebar-sub-header level3"><a href="/pages/69532e/#_2、赋值阶段-populatebean" class="sidebar-link">2、赋值阶段 - populateBean</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/69532e/#七、spring-bean-aware接口回调阶段" class="sidebar-link">七、Spring Bean Aware接口回调阶段</a></li><li class="sidebar-sub-header level2"><a href="/pages/69532e/#八、spring-bean初始化阶段" class="sidebar-link">八、Spring Bean初始化阶段</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/69532e/#_1、spring-bean初始化前阶段" class="sidebar-link">1、Spring Bean初始化前阶段</a></li><li class="sidebar-sub-header level3"><a href="/pages/69532e/#_2、spring-bean初始化阶段" class="sidebar-link">2、Spring Bean初始化阶段</a></li><li class="sidebar-sub-header level3"><a href="/pages/69532e/#_3、spring-bean初始化后阶段" class="sidebar-link">3、Spring Bean初始化后阶段</a></li><li class="sidebar-sub-header level3"><a href="/pages/69532e/#_4、spring-bean初始化完成阶段" class="sidebar-link">4、Spring Bean初始化完成阶段</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/69532e/#九、spring-bean销毁阶段" class="sidebar-link">九、Spring Bean销毁阶段</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/69532e/#spring-bean销毁前阶段" class="sidebar-link">Spring Bean销毁前阶段</a></li><li class="sidebar-sub-header level3"><a href="/pages/69532e/#spring-bean销毁阶段" class="sidebar-link">Spring Bean销毁阶段</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/69532e/#十、spring-bean垃圾收集" class="sidebar-link">十、Spring Bean垃圾收集</a></li></ul></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=%E3%80%8ASpring%E3%80%8B%E7%AC%94%E8%AE%B0" title="分类" data-v-06225672>《Spring》笔记</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/binxin5108" target="_blank" title="作者" class="beLink" data-v-06225672>zhoubg</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2021-12-28</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">Spring Bean生命周期<!----></h1>  <div class="theme-vdoing-content content__default"><h2 id="一、spring-bean元信息配置和解析阶段"><a href="#一、spring-bean元信息配置和解析阶段" class="header-anchor">#</a> 一、Spring Bean元信息配置和解析阶段</h2> <h3 id="_1、spring-bean元信息配置"><a href="#_1、spring-bean元信息配置" class="header-anchor">#</a> 1、Spring Bean元信息配置</h3> <p>元信息配置有 3 中方式：</p> <ul><li>面向资源
<ul><li>XML 资源配置 -- 2.5之前常用</li> <li>Properties 资源配置 -- 基本不用</li></ul></li> <li>面向注解 -- 目前主流</li> <li>面向 API -- 底层</li></ul> <h3 id="_2、spring-bean元信息解析"><a href="#_2、spring-bean元信息解析" class="header-anchor">#</a> 2、Spring Bean元信息解析</h3> <p>Bean 元信息解析主要分为面向资源的解析和面向注解的解析</p> <ul><li>面向资源 BeanDefinition 解析
<ul><li>接口 <code>BeanDefinitionReader</code> :
<ul><li>XML 实现 ：<code>XmlBeanDefinitionReader</code></li> <li>Properties 实现：<code>PropertiesBeanDefinitionReader</code></li></ul></li> <li>XML 解析器 - <code>BeanDefinitionParser</code></li></ul></li> <li>面向注解 BeanDefinition 解析
<ul><li>类 <code>AnnotatedBeanDefinitionReader</code></li></ul></li></ul> <p>Properties 配置和解析示例：</p> <div class="theme-code-group" data-v-2f5f1757><div class="theme-code-group__nav" data-v-2f5f1757><ul class="theme-code-group__ul" data-v-2f5f1757></ul></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java extra-class" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token comment" data-v-4f1e9d0c>/**
 * Properties 资源 Bean 元信息配置解析示例
 */</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>BeanMetadataConfigurationDemo</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>

    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>static</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>main</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>String</span><span class="token punctuation" data-v-4f1e9d0c>[</span><span class="token punctuation" data-v-4f1e9d0c>]</span> args<span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token class-name" data-v-4f1e9d0c>DefaultListableBeanFactory</span> beanFactory <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>DefaultListableBeanFactory</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 实例化基于 Properties 资源 BeanDefinitionReader</span>
        <span class="token class-name" data-v-4f1e9d0c>PropertiesBeanDefinitionReader</span> beanDefinitionReader <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>PropertiesBeanDefinitionReader</span><span class="token punctuation" data-v-4f1e9d0c>(</span>beanFactory<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>String</span> location <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token string" data-v-4f1e9d0c>&quot;META-INF/user.properties&quot;</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 基于 ClassPath 加载 properties 资源</span>
        <span class="token class-name" data-v-4f1e9d0c>Resource</span> resource <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>ClassPathResource</span><span class="token punctuation" data-v-4f1e9d0c>(</span>location<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 指定字符编码 UTF-8</span>
        <span class="token class-name" data-v-4f1e9d0c>EncodedResource</span> encodedResource <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>EncodedResource</span><span class="token punctuation" data-v-4f1e9d0c>(</span>resource<span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token string" data-v-4f1e9d0c>&quot;UTF-8&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>int</span> beanNumbers <span class="token operator" data-v-4f1e9d0c>=</span> beanDefinitionReader<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>loadBeanDefinitions</span><span class="token punctuation" data-v-4f1e9d0c>(</span>encodedResource<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;已加载 BeanDefinition 数量：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> beanNumbers<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 通过 Bean Id 和类型进行依赖查找</span>
        <span class="token class-name" data-v-4f1e9d0c>User</span> user <span class="token operator" data-v-4f1e9d0c>=</span> beanFactory<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getBean</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>User</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token keyword" data-v-4f1e9d0c>class</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>user<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>

</code></pre></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-properties extra-class" data-v-4f1e9d0c><pre class="language-properties" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token comment" data-v-4f1e9d0c>## user.(class) 指定Bean的Class</span>
<span class="token key attr-name" data-v-4f1e9d0c>user.(class)</span> <span class="token punctuation" data-v-4f1e9d0c>=</span> <span class="token value attr-value" data-v-4f1e9d0c>org.geekbang.thinking.in.spring.ioc.overview.domain.User</span>
<span class="token key attr-name" data-v-4f1e9d0c>user.id</span> <span class="token punctuation" data-v-4f1e9d0c>=</span> <span class="token value attr-value" data-v-4f1e9d0c>001</span>
<span class="token key attr-name" data-v-4f1e9d0c>user.name</span> <span class="token punctuation" data-v-4f1e9d0c>=</span> <span class="token value attr-value" data-v-4f1e9d0c>小马哥</span>
<span class="token key attr-name" data-v-4f1e9d0c>user.city</span> <span class="token punctuation" data-v-4f1e9d0c>=</span> <span class="token value attr-value" data-v-4f1e9d0c>HANGZHOU</span>
</code></pre></div></div> <pre class="pre-blank" data-v-2f5f1757>// Make sure to add code blocks to your code group</pre></div> <p>基于注解的配置和解析示例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 注解 BeanDefinition 解析示例
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AnnotatedBeanDefinitionParsingDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DefaultListableBeanFactory</span> beanFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultListableBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 基于 Java 注解的 AnnotatedBeanDefinitionReader 的实现</span>
        <span class="token class-name">AnnotatedBeanDefinitionReader</span> beanDefinitionReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotatedBeanDefinitionReader</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> beanDefinitionCountBefore <span class="token operator">=</span> beanFactory<span class="token punctuation">.</span><span class="token function">getBeanDefinitionCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0 </span>
        <span class="token comment">// 注册当前类（非 @Component class）</span>
        beanDefinitionReader<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">AnnotatedBeanDefinitionParsingDemo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> beanDefinitionCountAfter <span class="token operator">=</span> beanFactory<span class="token punctuation">.</span><span class="token function">getBeanDefinitionCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> beanDefinitionCount <span class="token operator">=</span> beanDefinitionCountAfter <span class="token operator">-</span> beanDefinitionCountBefore<span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;已加载 BeanDefinition 数量：&quot;</span> <span class="token operator">+</span> beanDefinitionCount<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
        <span class="token comment">// 普通的 Class 作为 Component 注册到 Spring IoC 容器后，通常 Bean 名称为 annotatedBeanDefinitionParsingDemo</span>
        <span class="token comment">// Bean 名称生成来自于 BeanNameGenerator，注解实现 AnnotationBeanNameGenerator</span>
        <span class="token class-name">AnnotatedBeanDefinitionParsingDemo</span> demo <span class="token operator">=</span> beanFactory<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;annotatedBeanDefinitionParsingDemo&quot;</span><span class="token punctuation">,</span>
                <span class="token class-name">AnnotatedBeanDefinitionParsingDemo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>demo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="二、spring-bean注册阶段"><a href="#二、spring-bean注册阶段" class="header-anchor">#</a> 二、Spring Bean注册阶段</h2> <p>BeanDefinition 注册接口:</p> <ul><li><code>BeanDefinitionRegistry</code></li></ul> <h2 id="三、spring-beandefinition-合并阶段"><a href="#三、spring-beandefinition-合并阶段" class="header-anchor">#</a> 三、Spring BeanDefinition 合并阶段</h2> <p>我们知道子类可以继承父类的属性，BeanDefinition 其实也存在这种“继承”的概念，在 XML 方式，可以通过<code>parent</code> 属性来设置父 BeanDefinition：</p> <div class="language-xml extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-xml"><code><span class="token comment">&lt;!-- Root BeanDefinition 不需要合并，不存在 parent --&gt;</span>
<span class="token comment">&lt;!-- 普通 beanDefinition GenericBeanDefinition --&gt;</span>
<span class="token comment">&lt;!-- 经过合并后 GenericBeanDefinition 变成 RootBeanDefinition --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.geekbang.thinking.in.spring.ioc.overview.domain.User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>小马哥<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>city<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>HANGZHOU<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>workCities<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>BEIJING,HANGZHOU<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>lifeCities<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>BEIJING<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>SHANGHAI<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>configFileLocation<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>classpath:/META-INF/user-config.properties<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 普通 beanDefinition GenericBeanDefinition --&gt;</span>
<span class="token comment">&lt;!-- 合并后 GenericBeanDefinition 变成 RootBeanDefinition，并且覆盖 parent 相关配置--&gt;</span>
<span class="token comment">&lt;!-- primary = true , 增加了一个 address 属性 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>superUser<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.geekbang.thinking.in.spring.ioc.overview.domain.SuperUser<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">parent</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span> <span class="token attr-name">primary</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>address<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>杭州<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>上述配置中的类<code>SuperUesr</code> 继承了 <code>User</code> , 并扩充了一个address属性 ；在Bean定义中，直接用 <code>parent=&quot;user&quot;</code> 来继承 id为user 的Bean 定义。</p> <p>在 Spring 中 Bean 定义信息的模型接口是 <code>BeanDefiniton</code>， 其变种主要有<code>RootBeanDefinition</code>、<code>GenericBeanDefinition</code>，其通用实现抽象类是 <code>AbstractBeanDefinition</code>，下面为抽取模型的相关定义：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BeanDefinition</span> <span class="token keyword">extends</span> <span class="token class-name">AttributeAccessor</span><span class="token punctuation">,</span> <span class="token class-name">BeanMetadataElement</span> <span class="token punctuation">{</span>
    
    <span class="token comment">/**
	 * 返回当前 Bean定义 的 父类Bean定义的名称
	 * Return the name of the parent definition of this bean definition, if any.
	 */</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token class-name">String</span> <span class="token function">getParentName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * RootBeanDefinition 定义中的 getParentName 始终未 null,
 * 也就是说 RootBeanDefinition 是根定义，是没有父定义的
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RootBeanDefinition</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractBeanDefinition</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getParentName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * GenericBeanDefinition 从名字看就是普通的 Bean 定义
 * 我们自定义的Bean定义一般都是GenericBeanDefinition，如果有parent的话parentName不为空
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GenericBeanDefinition</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractBeanDefinition</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setParentName</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> parentName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>parentName <span class="token operator">=</span> parentName<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getParentName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parentName<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

</code></pre></div><p>在创建Bean实例的是时候，我们只能使用 <code>RootBeanDefinition</code> 类型作为参数，也就是说我们定义的这些<code>GenericBeanDefinition</code>，在创建实例前要经过合并：<code>GenericBeanDefinition</code>  合并成 <code>RootBeanDefinition</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * Create a bean instance for the given merged bean definition (and arguments).
 * The bean definition will already have been merged with the parent definition
 * in case of a child definition.
 * 
 * 通过给定的已经合并过的bean definition来创建实例
 * 这个bean definition是已经合并了父definition了的
*/</span>
<span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token class-name">Object</span> <span class="token function">createBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">RootBeanDefinition</span> mbd<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token keyword">throws</span> <span class="token class-name">BeanCreationException</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_1、mergedbeandefinition-什么时候进行"><a href="#_1、mergedbeandefinition-什么时候进行" class="header-anchor">#</a> 1、<code>MergedBeanDefinition</code> 什么时候进行?</h3> <p>如上文说的，在创建 Bean 实例之前进行合并：<code>AbstractBeanFacotory#doGetBean</code>方法中，调用<code>createBean</code>方法之前</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">doGetBean</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token keyword">final</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> requiredType<span class="token punctuation">,</span>
			<span class="token annotation punctuation">@Nullable</span> <span class="token keyword">final</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">,</span> <span class="token keyword">boolean</span> typeCheckOnly<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
	<span class="token comment">// ...</span>
	<span class="token comment">// 这里根据bean名称获取MergedBeanDefinition，结果类型是RootBeanDefinition </span>
	<span class="token keyword">final</span> <span class="token class-name">RootBeanDefinition</span> mbd <span class="token operator">=</span> <span class="token function">getMergedLocalBeanDefinition</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// ...		</span>
	<span class="token function">createBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2、mergedbeandefinition-合并过程"><a href="#_2、mergedbeandefinition-合并过程" class="header-anchor">#</a> 2、<code>MergedBeanDefinition</code> 合并过程</h3> <p>从上面代码可以合并Bean的方法是 <strong><code>AbstractBeanFacotory#getMergedLocalBeanDefinition(beanName)</code></strong>;</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 从本地BeanFactory中获取MergedBeanDefinition</span>
<span class="token keyword">protected</span> <span class="token class-name">RootBeanDefinition</span> <span class="token function">getMergedLocalBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">)</span> 
    <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
    <span class="token comment">// 先从 concurrent map 中去，有说明之前已经生成过.</span>
    <span class="token comment">// mergedBeanDefinitions 是 当前 BeanFactory 的 map</span>
    <span class="token class-name">RootBeanDefinition</span> mbd <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mergedBeanDefinitions<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mbd <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> mbd<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">return</span> <span class="token function">getMergedBeanDefinition</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> <span class="token function">getBeanDefinition</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//重载方法</span>
<span class="token keyword">protected</span> <span class="token class-name">RootBeanDefinition</span> <span class="token function">getMergedBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">BeanDefinition</span> bd<span class="token punctuation">)</span>
    <span class="token keyword">throws</span> <span class="token class-name">BeanDefinitionStoreException</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">getMergedBeanDefinition</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> bd<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">// </span>
<span class="token keyword">protected</span> <span class="token class-name">RootBeanDefinition</span> <span class="token function">getMergedBeanDefinition</span><span class="token punctuation">(</span>
			<span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">BeanDefinition</span> bd<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">BeanDefinition</span> containingBd<span class="token punctuation">)</span>
			<span class="token keyword">throws</span> <span class="token class-name">BeanDefinitionStoreException</span> <span class="token punctuation">{</span>

		<span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mergedBeanDefinitions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// 准备一个RootBeanDefinition变量引用，用于记录要构建和最终要返回的BeanDefinition，</span>
			<span class="token comment">// 这里根据上下文不难猜测 mbd 应该就是 mergedBeanDefinition 的缩写。</span>
			<span class="token class-name">RootBeanDefinition</span> mbd <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
			<span class="token class-name">RootBeanDefinition</span> previous <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

			<span class="token comment">// containingBd 内嵌bean 一般都是null</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>containingBd <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				mbd <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mergedBeanDefinitions<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// mbd为空 或者 mbd.state 状态为需要remerge</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>mbd <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> mbd<span class="token punctuation">.</span>stale<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>bd<span class="token punctuation">.</span><span class="token function">getParentName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token comment">// bd不是一个ChildBeanDefinition的情况,换句话讲，这 bd应该是 :</span>
					<span class="token comment">// 1. 一个独立的 GenericBeanDefinition 实例，parentName 属性为null</span>
					<span class="token comment">// 2. 或者是一个 RootBeanDefinition 实例，parentName 属性为null</span>
					<span class="token comment">// 此时mbd直接使用一个bd的复制品</span>
					<span class="token comment">// Use copy of given root bean definition.</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>bd <span class="token keyword">instanceof</span> <span class="token class-name">RootBeanDefinition</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>						
						mbd <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">RootBeanDefinition</span><span class="token punctuation">)</span> bd<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cloneBeanDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">else</span> <span class="token punctuation">{</span>
						mbd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RootBeanDefinition</span><span class="token punctuation">(</span>bd<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span> <span class="token punctuation">{</span>
					<span class="token comment">// 说明存在parent bean definition,</span>
					<span class="token comment">// 这种情况下，需要将bd和其parent bean definition 合并到一起，</span>
					<span class="token comment">// 形成最终的 mbd</span>
					<span class="token comment">// 下面是获取bd的 parent bean definition 的过程，最终结果记录到 pbd，</span>
					<span class="token comment">// 并且可以看到该过程中递归使用了getMergedBeanDefinition(), 为什么呢?</span>
					<span class="token comment">// 因为 bd 的 parent bd 可能也还存在getParentName()，所以该过程</span>
					<span class="token comment">// 需要递归处理</span>
					<span class="token comment">// Child bean definition: needs to be merged with parent.</span>
					<span class="token class-name">BeanDefinition</span> pbd<span class="token punctuation">;</span>

                    <span class="token class-name">String</span> parentBeanName <span class="token operator">=</span> <span class="token function">transformedBeanName</span><span class="token punctuation">(</span>bd<span class="token punctuation">.</span><span class="token function">getParentName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>beanName<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>parentBeanName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        pbd <span class="token operator">=</span> <span class="token function">getMergedBeanDefinition</span><span class="token punctuation">(</span>parentBeanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        <span class="token comment">// 父BeanFactory查找</span>
                        <span class="token class-name">BeanFactory</span> parent <span class="token operator">=</span> <span class="token function">getParentBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token keyword">instanceof</span> <span class="token class-name">ConfigurableBeanFactory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            pbd <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableBeanFactory</span><span class="token punctuation">)</span> 
                                   parent<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMergedBeanDefinition</span><span class="token punctuation">(</span>parentBeanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token comment">// ...</span>
                    <span class="token punctuation">}</span>
				
					<span class="token comment">// Deep copy with overridden values.</span>
					<span class="token comment">// 现在已经获取 bd 的parent bd到pbd，从上面的过程可以看出，这个pbd</span>
					<span class="token comment">// 也是已经&quot;合并&quot;过的。</span>
					<span class="token comment">// 这里根据pbd创建最终的mbd，然后再使用bd覆盖一次，</span>
					<span class="token comment">// 这样就相当于mbd来自两个BeanDefinition:</span>
					<span class="token comment">// 当前 BeanDefinition 及其合并的(&quot;Merged&quot;)双亲 BeanDefinition,</span>
					<span class="token comment">// 然后mbd就是针对当前bd的一个MergedBeanDefinition(合并的BeanDefinition)了。</span>
					mbd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RootBeanDefinition</span><span class="token punctuation">(</span>pbd<span class="token punctuation">)</span><span class="token punctuation">;</span>
					mbd<span class="token punctuation">.</span><span class="token function">overrideFrom</span><span class="token punctuation">(</span>bd<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// ...</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> mbd<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

</code></pre></div><h3 id="_3、mergedbeandefinition的应用"><a href="#_3、mergedbeandefinition的应用" class="header-anchor">#</a> 3、<code>MergedBeanDefinition</code>的应用</h3> <p>在<code>doCreateBean</code>的方法中，我们看到在 Bean 实例创建后，Bean 实例属性填充之前，会有一个 <code>applyMergedBeanDefinitionPostProcessors()</code> 调用，会将<code>MergedBeanDefinitionPostProcessor</code>应用到我们合并后的Bean定义中，也就是说我们可以在bean定义合并之后做一些自定义操作，比如往合并后的Bean定义中添加一些信息。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">doCreateBean</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">RootBeanDefinition</span> mbd<span class="token punctuation">,</span> 
	<span class="token keyword">final</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>	<span class="token keyword">throws</span> <span class="token class-name">BeanCreationException</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>

		<span class="token comment">// 创建bean实例</span>
		instanceWrapper <span class="token operator">=</span> <span class="token function">createBeanInstance</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>

		 <span class="token comment">// ...        </span>
		 
	    <span class="token comment">// 修改 merged bean definition 的 BeanPostProcessor 的执行	</span>
        <span class="token comment">// ==== 调用 MergedBeanDefinitionPostProcessor ====</span>
		<span class="token function">applyMergedBeanDefinitionPostProcessors</span><span class="token punctuation">(</span>mbd<span class="token punctuation">,</span> beanType<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span> 
		
       <span class="token comment">// ...</span>

	   <span class="token comment">// 填充 bean 属性:依赖注入处理，属性设置</span>
	   <span class="token function">populateBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">,</span> instanceWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token comment">// ...                 </span>
<span class="token punctuation">}</span>
</code></pre></div><p>方法<code>applyMergedBeanDefinitionPostProcessors()</code>的实现如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 找到容器中注册的所有BeanPostProcessor中每一个MergedBeanDefinitionPostProcessor，</span>
<span class="token comment">// 将它们应用到指定的RootBeanDefinition mbd上，这里 mbd 其实就是一个合并后的 MergedBeanDefinition。</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">applyMergedBeanDefinitionPostProcessors</span><span class="token punctuation">(</span><span class="token class-name">RootBeanDefinition</span> mbd<span class="token punctuation">,</span> 
                                                       <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> beanType<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">BeanPostProcessor</span> bp <span class="token operator">:</span> <span class="token function">getBeanPostProcessors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>bp <span class="token keyword">instanceof</span> <span class="token class-name">MergedBeanDefinitionPostProcessor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">MergedBeanDefinitionPostProcessor</span> bdp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">MergedBeanDefinitionPostProcessor</span><span class="token punctuation">)</span> bp<span class="token punctuation">;</span>
            bdp<span class="token punctuation">.</span><span class="token function">postProcessMergedBeanDefinition</span><span class="token punctuation">(</span>mbd<span class="token punctuation">,</span> beanType<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>Spring 内部的<code>AutowiredAnnotationBeanPostProcessor</code>就使用到了<code>MergedBeanDefinitionPostProcessor</code>，其实现了<code>MergedBeanDefinitionPostProcessor</code>,它在一个bean的<code>postProcessMergedBeanDefinition()</code>阶段，获取该bean的依赖注入元数据(哪些方法使用了<code>@Autowired</code>,<code>@Inject</code>,<code>@Value</code>等等)，随后用于该bean属性填充中依赖注入执行阶段的输入</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AutowiredAnnotationBeanPostProcessor</span> <span class="token keyword">extends</span> <span class="token class-name">InstantiationAwareBeanPostProcessorAdapter</span>
		<span class="token keyword">implements</span> <span class="token class-name">MergedBeanDefinitionPostProcessor</span><span class="token punctuation">,</span> <span class="token class-name">PriorityOrdered</span><span class="token punctuation">,</span> <span class="token class-name">BeanFactoryAware</span> <span class="token punctuation">{</span>
	<span class="token comment">// ...		</span>
	<span class="token comment">// 在每个bean实例化后，初始化前执行，获取并记录该bean属性注入的元数据，在随后的属性注入时使用</span>
	<span class="token comment">// 该方法由接口MergedBeanDefinitionPostProcessor定义</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postProcessMergedBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">RootBeanDefinition</span> beanDefinition<span class="token punctuation">,</span> 
		<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> beanType<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 获取指定bean的属性注入元数据</span>
		<span class="token class-name">InjectionMetadata</span> metadata <span class="token operator">=</span> <span class="token function">findAutowiringMetadata</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> beanType<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		metadata<span class="token punctuation">.</span><span class="token function">checkConfigMembers</span><span class="token punctuation">(</span>beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>总结：</strong></p> <ul><li>根据原始<code>BeanDefinition</code>及其可能存在的双亲<code>BeanDefinition</code>中的<code>bean</code>定义信息&quot;合并&quot;而得来的一个<code>RootBeanDefinition</code>；</li> <li>每个<code>Bean</code>的创建需要的是一个<code>MergedBeanDefinition</code>，也就是需要基于原始<code>BeanDefinition</code>及其双亲<code>BeanDefinition</code>信息得到一个信息&quot;合并&quot;之后的<code>BeanDefinition</code>；</li> <li>Spring框架同时提供了一个机会给框架其他部分，或者开发人员用于在bean创建过程中，<code>MergedBeanDefinition</code> 生成之后，<code>bean</code>属性填充之前，对该<code>bean</code>和该<code>MergedBeanDefinition</code>做一次回调，相应的回调接口是<code>MergedBeanDefinitionPostProcessor</code>。</li> <li><code>MergedBeanDefinition</code>没有相应的Spring接口或类，它是处于一个内部使用目的合并自其它<code>BeanDefinition</code>对象，其具体对象所使用的实现类类型是<code>RootBeanDefinition</code>。</li></ul> <h2 id="四、spring-bean-class-加载阶段"><a href="#四、spring-bean-class-加载阶段" class="header-anchor">#</a> 四、Spring Bean Class 加载阶段</h2> <p>方法：<code>AbstractBeanFactory#resolveBeanClass</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">resolveBeanClass</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">RootBeanDefinition</span> mbd<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> typesToMatch<span class="token punctuation">)</span>
</code></pre></div><p>方法调用入口：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
    * AbstractAutowireCapableBeanFactory的核心方法：创建 Bean 实例
    * 给Bean 实例属性赋值、应用 post-processors 等
    * Central method of this class: creates a bean instance,
    * populates the bean instance, applies post-processors, etc.
    * @see #doCreateBean
    */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">createBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">RootBeanDefinition</span> mbd<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">BeanCreationException</span> <span class="token punctuation">{</span>

    <span class="token comment">// 用来创建 Bean 实例的 beanDefinition</span>
    <span class="token class-name">RootBeanDefinition</span> mbdToUse <span class="token operator">=</span> mbd<span class="token punctuation">;</span>
    
    <span class="token comment">// Spring BeanDefinition Class 加载阶段</span>
    <span class="token comment">// 调用父类 AbstractBeanFactory#resolveBeanClass 方法解析加载 Bean 的 Class</span>
    <span class="token comment">// 并且克隆一个新的 RootBeanDefinition ，把加载的Class 设置到clone后的 RootBeanDefinition</span>
    <span class="token comment">// 避免在dynamically resolved Class的情况下设值给合并后共享的mdb中，</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> resolvedClass <span class="token operator">=</span> <span class="token function">resolveBeanClass</span><span class="token punctuation">(</span>mbd<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>resolvedClass <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>mbd<span class="token punctuation">.</span><span class="token function">hasBeanClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> mbd<span class="token punctuation">.</span><span class="token function">getBeanClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mbdToUse <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RootBeanDefinition</span><span class="token punctuation">(</span>mbd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mbdToUse<span class="token punctuation">.</span><span class="token function">setBeanClass</span><span class="token punctuation">(</span>resolvedClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>

    <span class="token comment">// Spring Bean 实例化前阶段：应用 before-instantiation post-processors,</span>
    <span class="token comment">// Give BeanPostProcessors a chance to return a proxy instead of the target bean instance.</span>
    <span class="token class-name">Object</span> bean <span class="token operator">=</span> <span class="token function">resolveBeforeInstantiation</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbdToUse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//...</span>
    <span class="token class-name">Object</span> beanInstance <span class="token operator">=</span> <span class="token function">doCreateBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbdToUse<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> beanInstance<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>接下来看下具体的 <code>resolveBeanClass</code> 方法：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">resolveBeanClass</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">RootBeanDefinition</span> mbd<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> typesToMatch<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">CannotLoadBeanClassException</span> <span class="token punctuation">{</span>

    <span class="token comment">// ...</span>

    <span class="token comment">// 如果 mdb 中以及存在 bean Class 的引用，直接获取返回，说明之前已经加载过了</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mbd<span class="token punctuation">.</span><span class="token function">hasBeanClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> mbd<span class="token punctuation">.</span><span class="token function">getBeanClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Java 本身的安全机制，在没有配置的情况下都是null</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">AccessController</span><span class="token punctuation">.</span><span class="token function">doPrivileged</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">PrivilegedExceptionAction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
            <span class="token function">doResolveBeanClass</span><span class="token punctuation">(</span>mbd<span class="token punctuation">,</span> typesToMatch<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getAccessControlContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// mdb中不存在 且 没有配置安全管理器，则去解析加载Class</span>
        <span class="token keyword">return</span> <span class="token function">doResolveBeanClass</span><span class="token punctuation">(</span>mbd<span class="token punctuation">,</span> typesToMatch<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><p>BeanDefinition 中存在一个类型为<code>Object</code> 的属性 <code>beanClass</code>, 一开始里面存储的其实一个<code>String</code> 类型的名称，比如 <code>com.xxx.User</code>，此时 <code>mbd.hasBeanClass() = false</code>, 当加载过Class后，会重新设值属性值为 Class 的引用。</p> <p>AbstractBeanDefinition#hasBeanClass 代码：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// AbstractBeanDefinition#hasBeanClass</span>
<span class="token comment">// 判断 beanClass 存储的是不是 Class类型</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasBeanClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>beanClass <span class="token keyword">instanceof</span> <span class="token class-name">Class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>下面进入方法 <code>doResolveBeanClass(mbd, typesToMatch)</code> :</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">private</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">doResolveBeanClass</span><span class="token punctuation">(</span><span class="token class-name">RootBeanDefinition</span> mbd<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> typesToMatch<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{</span>

    <span class="token class-name">ClassLoader</span> beanClassLoader <span class="token operator">=</span> <span class="token function">getBeanClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ... 省略大量if代码 这里的if 代码常规基本不会进入 直接忽略</span>

    <span class="token comment">// Resolve regularly, caching the result in the BeanDefinition...</span>
    <span class="token comment">// 这里具体的加载类其实有回到 mdb 里面的方法里去了，传过去一个ClassLoader</span>
    <span class="token keyword">return</span> mbd<span class="token punctuation">.</span><span class="token function">resolveBeanClass</span><span class="token punctuation">(</span>beanClassLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>AbstractBeanDefinition#resolveBeanClass 代码：</p> <div class="language-java extra-class"><pre class="language-java"><code>
<span class="token comment">// 把 String 类型的 beanClass，通过 ClassUtils.forName 加载并重新赋给 beanClass</span>
<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">public</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">resolveBeanClass</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ClassLoader</span> classLoader<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> className <span class="token operator">=</span> <span class="token function">getBeanClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>className <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> resolvedClass <span class="token operator">=</span> <span class="token class-name">ClassUtils</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>className<span class="token punctuation">,</span> classLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>beanClass <span class="token operator">=</span> resolvedClass<span class="token punctuation">;</span>
    <span class="token keyword">return</span> resolvedClass<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getBeanClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Object</span> beanClassObject <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>beanClass<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>beanClassObject <span class="token keyword">instanceof</span> <span class="token class-name">Class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> beanClassObject<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> beanClassObject<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p><code>ClassUtils</code> 是 Spring 提供的一个工具类，最终还是调用到了 Java 里的 <code>Class.forName</code>。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">forName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ClassLoader</span> classLoader<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">,</span> <span class="token class-name">LinkageError</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> clToUse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>总结：</strong></p> <p>Spring Bean 在Class加载阶段中最终还是运用到传统的 Java ClassLoader，只不过在调用过程中，它会涉及到一些Java安全的细节操作，实际上这个操作在Java本身就已经具备了，而是我们通常没有把它激活因而会忽略调。</p> <h2 id="五、spring-bean实例化阶段"><a href="#五、spring-bean实例化阶段" class="header-anchor">#</a> 五、Spring Bean实例化阶段</h2> <p>在 Spring Bean Class 加载后，就到了 Bean 的创建阶段，也就是实例化 。BeanDefinition 里面拥有所有实例化需要用到的元信息，Spring 只需要选择合适的实例化方法和策略。</p> <p>实例化方法有两类，分别是<strong>工厂方法</strong>和<strong>构造器方法</strong>实例化，经常使用的是构造器方法。</p> <p>对于构造器方法，又有两种实例化策略，分别是<strong>cglib</strong> 和 <strong>反射</strong>，经常使用的是反射。</p> <ul><li>XML 中 配置使用工厂方法实例化的例子参考：<code>静态工厂方法</code>和 <code>实例工厂方法</code></li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- 静态工厂方法实例化 Bean, User 类中定义定义静态方法 createUser--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user-by-static-method<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.geekbang.thinking.in.spring.ioc.overview.domain.User<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">factory-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>createUser<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

<span class="token comment">&lt;!-- 实例（Bean）工厂方法实例化 Bean, 通过工厂 userFactory 的方法 createUser 实例化 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user-by-instance-method<span class="token punctuation">&quot;</span></span> <span class="token attr-name">factory-bean</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userFactory<span class="token punctuation">&quot;</span></span> <span class="token attr-name">factory-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>createUser<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre></div><blockquote><p>使用工厂方法特点：Bean 定义中配置了<code>factory-method</code></p></blockquote> <ul><li>XML 中配置使用构造器方法实例化的例子参考：<code>无参构造器</code> 和 <code>有参构造器</code></li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- 使用无参构造器实例化--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user-by-noargs-constructor<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.geekbang.thinking.in.spring.ioc.overview.domain.User<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token comment">&lt;!-- 使用无参构造器实例化--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user-by-args-constructor<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.geekbang.thinking.in.spring.ioc.overview.domain.User<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test constructor with args<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>    
</code></pre></div><p>下面我们来看下具体 Bean 实例化的具体源码：<code>AbstractAutowireCapableBeanFactory#doCreateBean</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">doCreateBean</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">RootBeanDefinition</span> mbd<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token keyword">throws</span> <span class="token class-name">BeanCreationException</span> <span class="token punctuation">{</span>

    <span class="token comment">// 第一步  创建Bean实例 </span>
    <span class="token class-name">BeanWrapper</span> instanceWrapper <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mbd<span class="token punctuation">.</span><span class="token function">isSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        instanceWrapper <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>factoryBeanInstanceCache<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>instanceWrapper <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 调用 createBeanInstance 创建</span>
        instanceWrapper <span class="token operator">=</span> <span class="token function">createBeanInstance</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">final</span> <span class="token class-name">Object</span> bean <span class="token operator">=</span> instanceWrapper<span class="token punctuation">.</span><span class="token function">getWrappedInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> beanType <span class="token operator">=</span> instanceWrapper<span class="token punctuation">.</span><span class="token function">getWrappedClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>beanType <span class="token operator">!=</span> <span class="token class-name">NullBean</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mbd<span class="token punctuation">.</span>resolvedTargetType <span class="token operator">=</span> beanType<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
	<span class="token comment">// ...</span>
    
    <span class="token comment">// Allow post-processors to modify the merged bean definition.</span>
    <span class="token comment">// 第二步 执行MergedBeanDefinitionPostProcessors 的方法</span>
    <span class="token keyword">try</span><span class="token punctuation">{</span>
        <span class="token function">applyMergedBeanDefinitionPostProcessors</span><span class="token punctuation">(</span>mbd<span class="token punctuation">,</span> beanType<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// ...</span>

    <span class="token comment">// Initialize the bean instance.</span>
    <span class="token class-name">Object</span> exposedObject <span class="token operator">=</span> bean<span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// 第三步 填充 bean实例：依赖注入处理，属性设置</span>
        <span class="token function">populateBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">,</span> instanceWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 第四步 初始化bean实例：调用设置的初始化方法，接口定义的初始化方法，</span>
        <span class="token comment">//       以及相应的 pre-/post-init 生命周期回调函数</span>
        exposedObject <span class="token operator">=</span> <span class="token function">initializeBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> exposedObject<span class="token punctuation">,</span> mbd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// ...</span>

    <span class="token comment">// Register bean as disposable.</span>
    <span class="token comment">// 第六步 如果当前 bean 实现了有关销毁时的接口或者函数，将它进行相应的注册登记</span>
    <span class="token comment">//       供容器关闭时执行相应的回调函数</span>
    <span class="token function">registerDisposableBeanIfNecessary</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> bean<span class="token punctuation">,</span> mbd<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> exposedObject<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>源码可以看出，创建 bean 实例的方法又是调用 <code>createBeanInstance(beanName, mbd, args)</code>:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">BeanWrapper</span> <span class="token function">createBeanInstance</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">RootBeanDefinition</span> mbd<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 这个在上文分析过，获取Bean 的 Class，之前没加载过的话加载Class</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> beanClass <span class="token operator">=</span> <span class="token function">resolveBeanClass</span><span class="token punctuation">(</span>mbd<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ...</span>

    <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> instanceSupplier <span class="token operator">=</span> mbd<span class="token punctuation">.</span><span class="token function">getInstanceSupplier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>instanceSupplier <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">obtainFromSupplier</span><span class="token punctuation">(</span>instanceSupplier<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 如果bean定义中存在factory-method，就是用工厂方法实例化，小众</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mbd<span class="token punctuation">.</span><span class="token function">getFactoryMethodName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">instantiateUsingFactoryMethod</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>

    <span class="token comment">// Candidate constructors for autowiring?</span>
    <span class="token comment">// 如果定义了SmartInstantiationAwareBeanPostProcessor并且给Bean 配置了指定的构造器，并且有参数</span>
    <span class="token comment">// 就使用带参构造器</span>
    <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> ctors <span class="token operator">=</span> <span class="token function">determineConstructorsFromBeanPostProcessors</span><span class="token punctuation">(</span>beanClass<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ctors <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">||</span> mbd<span class="token punctuation">.</span><span class="token function">getResolvedAutowireMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> AUTOWIRE_CONSTRUCTOR <span class="token operator">||</span>
        mbd<span class="token punctuation">.</span><span class="token function">hasConstructorArgumentValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token class-name">ObjectUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">autowireConstructor</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">,</span> ctors<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>

    <span class="token comment">// No special handling: simply use no-arg constructor.</span>
    <span class="token comment">// 没有特殊处理设置，都会走到这里，使用默认的无参构造器实例化</span>
    <span class="token keyword">return</span> <span class="token function">instantiateBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>从上面的源码可以看出，Spring Bean 的实例化主要根据 Bean定义的元信息来决定使用哪种实例化方法，主要有3种：</p> <ul><li><code>instantiateUsingFactoryMethod</code>: 工程方法实例化</li> <li><code>autowireConstructor</code>: 有参构造器实例化</li> <li><code>instantiateBean</code>: 默认无参构造器实例化</li></ul> <p>接下来我们继续分析无参构造器实例化方法：<code>instantiateBean</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">BeanWrapper</span> <span class="token function">instantiateBean</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">RootBeanDefinition</span> mbd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> beanInstance<span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">BeanFactory</span> parent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            beanInstance <span class="token operator">=</span> <span class="token class-name">AccessController</span><span class="token punctuation">.</span><span class="token function">doPrivileged</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">PrivilegedAction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
                        <span class="token function">getInstantiationStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">instantiate</span><span class="token punctuation">(</span>mbd<span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> parent<span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token function">getAccessControlContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 选择一种实例化策略实例化</span>
            <span class="token comment">// instantiate方法 根据 Bean定义的元信息判断选择 cglib 还是 反射</span>
            <span class="token comment">// 如果我们没有自定义策略 getInstantiationStrategy() 返回的就是默认的CglibSubclassingInstantiationStrategy()</span>
            <span class="token comment">// CglibSubclassingInstantiationStrategy 的中instantiate方法直接使用的是父类SimpleInstantiationStrategy中定义的</span>
            beanInstance <span class="token operator">=</span> <span class="token function">getInstantiationStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">instantiate</span><span class="token punctuation">(</span>mbd<span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">BeanWrapper</span> bw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BeanWrapperImpl</span><span class="token punctuation">(</span>beanInstance<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">initBeanWrapper</span><span class="token punctuation">(</span>bw<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> bw<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>继续查看<code>instantiate</code> y源码：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">instantiate</span><span class="token punctuation">(</span><span class="token class-name">RootBeanDefinition</span> bd<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">BeanFactory</span> owner<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Don't override the class with CGLIB if no overrides.</span>
    <span class="token comment">// 判断 Bean 定义中有没有配置 replace 或 look-up 方法，配置了的话直接走 cglib 策略</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>bd<span class="token punctuation">.</span><span class="token function">hasMethodOverrides</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> constructorToUse<span class="token punctuation">;</span>
        
        <span class="token comment">// ... 赋值 constructorToUse</span>
        
        <span class="token comment">// 采用反射方式实例化</span>
        <span class="token keyword">return</span> <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">instantiateClass</span><span class="token punctuation">(</span>constructorToUse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// Must generate CGLIB subclass.</span>
        <span class="token comment">// 采用cglib代理增强方式实例化</span>
        <span class="token keyword">return</span> <span class="token function">instantiateWithMethodInjection</span><span class="token punctuation">(</span>bd<span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> owner<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>先判断如果beanDefinition.getMethodOverrides()为空也就是用户没有使用replace或者lookup的配置方法，那么直接使用反射的方式，但是如果使用了这两个特性，因为需要将这两个配置提供的功能切入进去，所以就必须要使用动态代理的方式将包含两个特性所对应的逻辑的拦截增强器设置进去，这样才可以保证在调用方法的时候会被相应的拦截器增强，返回值为包含拦截器的代理实例。---引用自《spring 源码深度剖析》这本书</p></blockquote> <p>关于 Spring 的 replace 和lookup目前应该不怎么用，可以阅读了解：https://my.oschina.net/wenbo123/blog/1590861</p> <p><strong>总结：</strong></p> <h3 id="_1、spring-bean实例化前阶段"><a href="#_1、spring-bean实例化前阶段" class="header-anchor">#</a> 1、Spring Bean实例化前阶段</h3> <p><code>before-instantiation</code>实例化前阶段：<code>postProcessBeforeInstantiation</code></p> <p>在调用<code>doCreateBean(beanName, mbdToUse, args)</code>方法前，我们注意到会执行<code>resolveBeforeInstantiation(beanName, mbdToUse)</code>方法，这个方法就是在实例化前应用<code>before-instantiation post-processors</code>，也就是执行 <code>InstantiationAwareBeanPostProcessor#postProcessBeforeInstantiation</code>：</p> <div class="language-java extra-class"><pre class="language-java"><code>	<span class="token annotation punctuation">@Nullable</span>
	<span class="token keyword">default</span> <span class="token class-name">Object</span> <span class="token function">postProcessBeforeInstantiation</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> beanClass<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
		<span class="token comment">// 如果实现类这里返回了非空的对象，那么就不会进入到后面的Bean创建环节了，直接返回此处的对象给调用者</span>
        <span class="token comment">// 非主流阶段</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2、spring-bean实例化阶段"><a href="#_2、spring-bean实例化阶段" class="header-anchor">#</a> 2、Spring Bean实例化阶段</h3> <p><code>instantiation</code>实例化阶段：<code>createBeanInstance(beanName, mbd, args)</code></p> <h3 id="_3、spring-bean实例化后阶段"><a href="#_3、spring-bean实例化后阶段" class="header-anchor">#</a> 3、Spring Bean实例化后阶段</h3> <p><code>after-instantiation</code>实例化后阶段：<code>postProcessAfterInstantiation</code></p> <p>在实例化完成后，我们看到代码进入到了属性填充赋值阶段<code>populateBean(beanName, mbd, instanceWrapper)</code>，这个是接下来的阶段，我们下文分析，在进行具体填充前，<code>populateBean</code> 里面会应用<code>after-instantiation post-processors</code>，也就是执行 <code>InstantiationAwareBeanPostProcessor#postProcessAfterInstantiation</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">default</span> <span class="token keyword">boolean</span> <span class="token function">postProcessAfterInstantiation</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果这里返回了false，就会直接跳过后续的属性赋值阶段了，到下一阶段 - Aware接口回调阶段</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id=""><a href="#" class="header-anchor">#</a></h3> <h2 id="六、spring-bean属性赋值阶段"><a href="#六、spring-bean属性赋值阶段" class="header-anchor">#</a> 六、Spring Bean属性赋值阶段</h2> <h3 id="_1、赋值前回调阶段-postprocessproperties"><a href="#_1、赋值前回调阶段-postprocessproperties" class="header-anchor">#</a> 1、赋值前回调阶段 - <code>postProcessProperties</code></h3> <ul><li>Bean 属性元信息
<ul><li>PropertyValues</li></ul></li> <li>Bean 属性赋值前回调
<ul><li>Spring 5.1 ：<code>InstantiationAwareBeanPostProcessor#postProcessProperties</code></li> <li>Spring 1.2 - 5.0 : <code>InstantiationAwareBeanPostProcessor#postProcessPropertyValues</code></li></ul></li></ul> <h3 id="_2、赋值阶段-populatebean"><a href="#_2、赋值阶段-populatebean" class="header-anchor">#</a> 2、赋值阶段 - <code>populateBean</code></h3> <h2 id="七、spring-bean-aware接口回调阶段"><a href="#七、spring-bean-aware接口回调阶段" class="header-anchor">#</a> 七、Spring Bean Aware接口回调阶段</h2> <p>Aware 接口回调：<code>initializeBean -- invokeAwareMethods(beanName,bean)</code></p> <h2 id="八、spring-bean初始化阶段"><a href="#八、spring-bean初始化阶段" class="header-anchor">#</a> 八、Spring Bean初始化阶段</h2> <h3 id="_1、spring-bean初始化前阶段"><a href="#_1、spring-bean初始化前阶段" class="header-anchor">#</a> 1、Spring Bean初始化前阶段</h3> <p>``initializeBean -- applyBeanPostProcessorsBeforeInitialization`</p> <h3 id="_2、spring-bean初始化阶段"><a href="#_2、spring-bean初始化阶段" class="header-anchor">#</a> 2、Spring Bean初始化阶段</h3> <p>``initializeBean -- invokeInitMethods(beanName, wrappedBean, mbd)`</p> <h3 id="_3、spring-bean初始化后阶段"><a href="#_3、spring-bean初始化后阶段" class="header-anchor">#</a> 3、Spring Bean初始化后阶段</h3> <p>``initializeBean -- applyBeanPostProcessorsAfterInitialization`</p> <h3 id="_4、spring-bean初始化完成阶段"><a href="#_4、spring-bean初始化完成阶段" class="header-anchor">#</a> 4、Spring Bean初始化完成阶段</h3> <h2 id="九、spring-bean销毁阶段"><a href="#九、spring-bean销毁阶段" class="header-anchor">#</a> 九、Spring Bean销毁阶段</h2> <h3 id="spring-bean销毁前阶段"><a href="#spring-bean销毁前阶段" class="header-anchor">#</a> Spring Bean销毁前阶段</h3> <h3 id="spring-bean销毁阶段"><a href="#spring-bean销毁阶段" class="header-anchor">#</a> Spring Bean销毁阶段</h3> <h2 id="十、spring-bean垃圾收集"><a href="#十、spring-bean垃圾收集" class="header-anchor">#</a> 十、Spring Bean垃圾收集</h2></div></div>  <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/01/18, 19:39:38</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/742851/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Spring Bean作用域</div></a> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/742851/" class="prev">Spring Bean作用域</a></span> <!----></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/da7318/"><div>
            AOF日志
            <!----></div></a> <span class="date">06-10</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/3cdfcb/"><div>
            redis高性能IO模型
            <!----></div></a> <span class="date">06-09</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/4c8247/"><div>
            redis的数据结构
            <!----></div></a> <span class="date">06-08</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:992132705@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/binxin5108" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2022
    <span>zhoubg | <img src="/img/gov.png" title="中华人民共和国工业和信息化部"><a href="http://beian.miit.gov.cn/" target="_blank" rel="noopener">粤ICP备18064823号</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.22150bd5.js" defer></script><script src="/assets/js/2.032d6d47.js" defer></script><script src="/assets/js/73.483dda2c.js" defer></script>
  </body>
</html>
