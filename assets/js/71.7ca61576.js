(window.webpackJsonp=window.webpackJsonp||[]).push([[71],{562:function(t,n,a){"use strict";a.r(n);var s=a(22),e=Object(s.a)({},(function(){var t=this,n=t.$createElement,a=t._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"依赖查找的来源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#依赖查找的来源"}},[t._v("#")]),t._v(" 依赖查找的来源")]),t._v(" "),a("p",[t._v("查找来源："),a("strong",[t._v("Spring BeanDefinition")]),t._v(" 和 "),a("strong",[t._v("单例对象")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("来源")]),t._v(" "),a("th",[t._v("配置元数据")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("Spring BeanDefinition")]),t._v(" "),a("td",[a("code",[t._v('<bean id="user" class="org.geekbang...User">')])])]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td",[a("code",[t._v("@Bean public User user(){...}")])])]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td",[a("code",[t._v("BeanDefinitionBuilder")])])]),t._v(" "),a("tr",[a("td",[t._v("单例对象")]),t._v(" "),a("td",[t._v("API 实现： "),a("code",[t._v("registerSingleton")])])])])]),t._v(" "),a("p",[t._v("除了我们自己注册的 BeanDefinition 和 单例对象，Spring 中本身内建了一些：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("内建的 BeanDefintion")])])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("Bean 名称")]),t._v(" "),a("th",[t._v("Bean 实例")]),t._v(" "),a("th",[t._v("使用场景")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("org.springframework.context. annotation.internalConfiguration AnnotationProcessor")]),t._v(" "),a("td",[a("code",[t._v("ConfigurationClassPostProcessor")]),t._v(" 对象")]),t._v(" "),a("td",[t._v("处理 Spring 配置类")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("org.springframework.context. annotation.internalAutowire dAnnotationProcessor")]),t._v(" "),a("td",[a("code",[t._v("AutowiredAnnotationBeanPostProcessor")]),t._v("对象")]),t._v(" "),a("td",[t._v("处理 @Autowired 以及 @Value注解")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("org.springframework.context. annotation.internalCommonAn notationProcessor")]),t._v(" "),a("td",[a("code",[t._v("CommonAnnotationBeanPostProcessor")]),t._v("对象")]),t._v(" "),a("td",[t._v("（条件激活）处理 JSR-250 注解，如 @PostConstruct 等")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("org.springframework.context. event.internalEventListener Processor")]),t._v(" "),a("td",[a("code",[t._v("EventListenerMethodProcessor")]),t._v("对象")]),t._v(" "),a("td",[t._v("处理标注 @EventListener 的Spring 事件监听方法")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("org.springframework.context. event.internalEventListener Factory")]),t._v(" "),a("td",[a("code",[t._v("DefaultEventListenerFactory")]),t._v(" 对象")]),t._v(" "),a("td",[t._v("@EventListener 事件监听方法适配为 ApplicationListener")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("org.springframework.context. annotation.internalPersiste nceAnnotationProcessor")]),t._v(" "),a("td",[a("code",[t._v("PersistenceAnnotationBeanPostProcessor")]),t._v(" 对象")]),t._v(" "),a("td",[t._v("（条件激活）处理 JPA 注解场景")])])])]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("内建的单例对象")])])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Bean 名称")]),t._v(" "),a("th",[t._v("Bean 实例")]),t._v(" "),a("th",[t._v("使用场景")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("environment")]),t._v(" "),a("td",[a("code",[t._v("Environment")]),t._v(" 对象")]),t._v(" "),a("td",[t._v("外部化配置以及 Profiles")])]),t._v(" "),a("tr",[a("td",[t._v("systemProperties")]),t._v(" "),a("td",[a("code",[t._v("java.util.Properties")]),t._v("对象")]),t._v(" "),a("td",[t._v("Java 系统属性")])]),t._v(" "),a("tr",[a("td",[t._v("systemEnvironment")]),t._v(" "),a("td",[a("code",[t._v("java.util.Map")]),t._v("对象")]),t._v(" "),a("td",[t._v("操作系统环境变量")])]),t._v(" "),a("tr",[a("td",[t._v("messageSource")]),t._v(" "),a("td",[a("code",[t._v("MessageSource")]),t._v(" 对象")]),t._v(" "),a("td",[t._v("国际化文案")])]),t._v(" "),a("tr",[a("td",[t._v("lifecycleProcessor")]),t._v(" "),a("td",[a("code",[t._v("LifecycleProcessor")]),t._v(" 对象")]),t._v(" "),a("td",[t._v("Lifecycle Bean 处理器")])]),t._v(" "),a("tr",[a("td",[t._v("applicationEventMulticaster")]),t._v(" "),a("td",[a("code",[t._v("ApplicationEventMulticaster")]),t._v("对象")]),t._v(" "),a("td",[t._v("Spring 事件广播器")])])])]),t._v(" "),a("h2",{attrs:{id:"依赖注入的来源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#依赖注入的来源"}},[t._v("#")]),t._v(" 依赖注入的来源")]),t._v(" "),a("p",[t._v("注入来源：除了 Spring BeanDefinition 和 单例对象  外，还可以注入"),a("strong",[t._v("非Spring 容器管理的对象（内建依赖）")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("来源")]),t._v(" "),a("th",[t._v("配置元数据")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("Spring BeanDefinition")]),t._v(" "),a("td",[a("code",[t._v('<bean id="user" class="org.geekbang...User">')])])]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td",[a("code",[t._v("@Bean public User user(){...}")])])]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td",[a("code",[t._v("BeanDefinitionBuilder")])])]),t._v(" "),a("tr",[a("td",[t._v("单例对象")]),t._v(" "),a("td",[t._v("API 实现： "),a("code",[t._v("registerSingleton")])])]),t._v(" "),a("tr",[a("td",[t._v("非 Spring 容器管理对象")]),t._v(" "),a("td",[t._v("API 实现："),a("code",[t._v("registerResolvableDependency")])])])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("还可以通过 "),a("code",[t._v("@Value")]),t._v(" 注解注入外部化的配置")])]),t._v(" "),a("h2",{attrs:{id:"spring容器管理和游离对象"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#spring容器管理和游离对象"}},[t._v("#")]),t._v(" Spring容器管理和游离对象")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("来源")]),t._v(" "),a("th",[t._v("Spring Bean 对象")]),t._v(" "),a("th",[t._v("生命周期管理")]),t._v(" "),a("th",[t._v("配置元信息")]),t._v(" "),a("th",[t._v("使用场景")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("Spring BeanDefinition")]),t._v(" "),a("td",[t._v("✔️")]),t._v(" "),a("td",[t._v("✔️")]),t._v(" "),a("td",[t._v("✔️")]),t._v(" "),a("td",[t._v("依赖查找、依赖注入")])]),t._v(" "),a("tr",[a("td",[t._v("单体对象")]),t._v(" "),a("td",[t._v("✔️")]),t._v(" "),a("td",[t._v("❌")]),t._v(" "),a("td",[t._v("❌")]),t._v(" "),a("td",[t._v("依赖查找、依赖注入")])]),t._v(" "),a("tr",[a("td",[t._v("Resolvable Dependency")]),t._v(" "),a("td",[t._v("❌")]),t._v(" "),a("td",[t._v("❌")]),t._v(" "),a("td",[t._v("❌")]),t._v(" "),a("td",[t._v("依赖注入")])])])]),t._v(" "),a("h2",{attrs:{id:"spring-beandefinition-作为依赖来源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#spring-beandefinition-作为依赖来源"}},[t._v("#")]),t._v(" Spring BeanDefinition 作为依赖来源")]),t._v(" "),a("ul",[a("li",[t._v("元数据："),a("code",[t._v("BeanDefinition")])]),t._v(" "),a("li",[t._v("注册："),a("code",[t._v("BeanDefinitionRegistry#registerBeanDefinition")])]),t._v(" "),a("li",[t._v("类型：延迟和非延迟")]),t._v(" "),a("li",[t._v("顺序：Bean 生命周期顺序按照注册顺序")])]),t._v(" "),a("h2",{attrs:{id:"单例对象作为依赖来源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#单例对象作为依赖来源"}},[t._v("#")]),t._v(" 单例对象作为依赖来源")]),t._v(" "),a("ul",[a("li",[t._v("来源：外部普通 Java 对象（不一定是 POJO）")]),t._v(" "),a("li",[t._v("注册："),a("code",[t._v("SingletonBeanRegistry#registerSingleton")])]),t._v(" "),a("li",[t._v("限制：\n"),a("ul",[a("li",[t._v("无生命周期管理")]),t._v(" "),a("li",[t._v("无法实现延迟初始化 Bean")])])])]),t._v(" "),a("h2",{attrs:{id:"非-spring-容器管理对象作为依赖来源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#非-spring-容器管理对象作为依赖来源"}},[t._v("#")]),t._v(" 非 Spring 容器管理对象作为依赖来源")]),t._v(" "),a("ul",[a("li",[t._v("注册："),a("code",[t._v("ConfigurableListableBeanFactory#registerResolvableDependency")])]),t._v(" "),a("li",[t._v("限制：\n"),a("ul",[a("li",[t._v("无生命周期管理")]),t._v(" "),a("li",[t._v("无法实现延迟初始化 Bean")]),t._v(" "),a("li",[t._v("无法通过依赖查找")])])])]),t._v(" "),a("p",[t._v("非 Spring 容器管理对象（游离对象/内建依赖/ResolvableDependency）Demo：")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * ResolvableDependency 作为依赖来源\n */")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ResolvableDependencySourceDemo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@PostConstruct")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建 BeanFactory 容器")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AnnotationConfigApplicationContext")]),t._v(" applicationContext "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AnnotationConfigApplicationContext")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 注册 Configuration Class（配置类） -> Spring Bean")]),t._v("\n        applicationContext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("register")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ResolvableDependencySourceDemo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        applicationContext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addBeanFactoryPostProcessor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("beanFactory "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 注册 Resolvable Dependency")]),t._v("\n            beanFactory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("registerResolvableDependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello,World"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 启动 Spring 应用上下文")]),t._v("\n        applicationContext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("refresh")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 显示地关闭 Spring 应用上下文")]),t._v("\n        applicationContext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("close")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("输出：")]),t._v(" "),a("div",{staticClass:"language-reStructuredText extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Hello,World\n")])])]),a("h2",{attrs:{id:"外部化配置作为依赖来源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#外部化配置作为依赖来源"}},[t._v("#")]),t._v(" 外部化配置作为依赖来源")]),t._v(" "),a("ul",[a("li",[t._v("类型：非常规 Spring 对象依赖来源")]),t._v(" "),a("li",[t._v("限制：\n"),a("ul",[a("li",[t._v("无生命周期管理")]),t._v(" "),a("li",[t._v("无法实现延迟初始化 Bean")]),t._v(" "),a("li",[t._v("无法通过依赖查找")])])])]),t._v(" "),a("p",[t._v("外部化配置Demo：")]),t._v(" "),a("code-group",[a("code-block",{attrs:{title:"ExternalConfigurationDependencySourceDemo.java"}},[a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 外部化配置作为依赖来源示例\n */")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Configuration")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@PropertySource")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"META-INF/default.properties"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("encoding"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UTF-8"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExternalConfigurationDependencySourceDemo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 默认 -1")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${user.id:-1}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),t._v(" id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${usr.name}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 资源注入")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${user.resource:classpath://default.properties}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Resource")]),t._v(" resource"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建 BeanFactory 容器")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AnnotationConfigApplicationContext")]),t._v(" applicationContext "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AnnotationConfigApplicationContext")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 注册 Configuration Class（配置类） -> Spring Bean")]),t._v("\n        applicationContext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("register")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExternalConfigurationDependencySourceDemo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 启动 Spring 应用上下文")]),t._v("\n        applicationContext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("refresh")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 依赖查找 ExternalConfigurationDependencySourceDemo Bean")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExternalConfigurationDependencySourceDemo")]),t._v(" demo "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" applicationContext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getBean")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExternalConfigurationDependencySourceDemo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"demo.id = "')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" demo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"demo.name = "')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" demo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"demo.resource = "')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" demo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("resource"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 显示地关闭 Spring 应用上下文")]),t._v("\n        applicationContext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("close")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),a("code-block",{attrs:{title:"default.properties"}},[a("div",{staticClass:"language-properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("user.id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("usr.name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("李四")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("user.resource")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("classpath://META-INF/default.properties")]),t._v("\n")])])])])],1),t._v(" "),a("p",[t._v("输出：")]),t._v(" "),a("div",{staticClass:"language-reStructuredText extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("demo.id = 1\ndemo.name = 李四\ndemo.resource = class path resource [META-INF/default.properties]\n")])])]),a("h2",{attrs:{id:"面试题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#面试题"}},[t._v("#")]),t._v(" 面试题")]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("注入和查找的依赖来源是否相同")]),t._v("❓")]),t._v(" "),a("p",[t._v("不相同，依赖查找的来源仅限于 Spring BeanDefinition 以及单例对象，而依赖注入的来源还包括 Resolvable Dependency 以及@Value 所标注的外部化配置")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("单例对象能在 IoC 容器启动后注册吗")]),t._v("❓")]),t._v(" "),a("p",[t._v("可以的，单例对象的注册与 BeanDefinition 不同，")]),t._v(" "),a("p",[t._v("BeanDefinition会被 "),a("code",[t._v("ConfigurableListableBeanFactory#freezeConfiguration()")]),t._v(" 方法影响，从而冻结注册，")]),t._v(" "),a("p",[t._v("单例对象则没有这个限制。")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Spring 依赖注入的来源有哪些❓")])]),t._v(" "),a("p",[t._v("Spring BeanDefinition、单例对象、Resolvable Dependency、"),a("code",[t._v("@Value")]),t._v(" 外部化配置")])])])],1)}),[],!1,null,null,null);n.default=e.exports}}]);