(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{540:function(s,t,e){"use strict";e.r(t);var n=e(22),a=Object(n.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("blockquote",[e("p",[s._v("本次安装采用 All-in-One 的模式在单节点上安装")])]),s._v(" "),e("h2",{attrs:{id:"_1、准备服务器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、准备服务器"}},[s._v("#")]),s._v(" 1、准备服务器")]),s._v(" "),e("p",[s._v("开通4c8g的机器；防火墙放行 3000 - 32767 端口；指定 hostname")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("hostnamectl set-hostname k8s-master\n")])])]),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),e("p",[s._v("官网的最低配置要求是 2 核 CPU，4G内存，但是我做实验发现 monitor 组件一直装不上，导致web界面看不到任何的状态统计信息，推荐使用4核8G做实验")])]),s._v(" "),e("p",[s._v("以下是我在青云上的机器：")]),s._v(" "),e("p",[e("img",{attrs:{src:"http://img.zhoubg.cn/static/image-20220516143600748.png",alt:"image-20220516143600748"}})]),s._v(" "),e("h2",{attrs:{id:"_2、安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、安装"}},[s._v("#")]),s._v(" 2、安装")]),s._v(" "),e("h3",{attrs:{id:"_1、准备-kubekey"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、准备-kubekey"}},[s._v("#")]),s._v(" 1、准备 KubeKey")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# export KKZONE=cn")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl -sfL https://get-kk.kubesphere.io | VERSION=v2.0.0 sh -")]),s._v("\n\n\nDownloading kubekey v2.0.0 from https://kubernetes.pek3b.qingstor.com/kubekey/releases/download/v2.0.0/kubekey-v2.0.0-linux-amd64.tar.gz "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n\nKubekey v2.0.0 Download Complete"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\ntotal "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("68472")]),s._v("\n-rwxr-xr-x "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1001")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("121")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("53764096")]),s._v(" Mar  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":05 kk\n-rw-r--r-- "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16348932")]),s._v(" May "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(":05 kubekey-v2.0.0-linux-amd64.tar.gz\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chmod +x kk ")]),s._v("\n")])])]),e("h3",{attrs:{id:"_2、使用-kubekey-引导安装集群"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、使用-kubekey-引导安装集群"}},[s._v("#")]),s._v(" 2、使用 KubeKey 引导安装集群")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("// 可能需要下面命令安装好conntrack\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum install -y conntrack")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./kk create cluster --with-kubernetes v1.21.5 --with-kubesphere v3.2.1")]),s._v("\n")])])]),e("p",[s._v("安装过程会去下载k8s组件和各种镜像，需要十几分钟，我的是4M带宽，最终控制台输出下列信息表示安装成功：")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#####################################################")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("###              Welcome to KubeSphere!           ###")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#####################################################")]),s._v("\n\nConsole: http://172.16.0.2:30880\nAccount: admin\nPassword: P@88w0rd\n\nNOTES：\n  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". After you log into the console, please check the\n     monitoring status of "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" components "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("\n     "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Cluster Management"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" If any "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" is not\n     ready, please "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wait")]),s._v(" patiently "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("until")]),s._v(" all components \n     are up and running.\n  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(". Please change the default password after login.\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#####################################################")]),s._v("\nhttps://kubesphere.io             "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-05-11 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(":34:40\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#####################################################")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(":34:44 CST success: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("k8s-master"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(":34:44 CST Pipeline"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("CreateClusterPipeline"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" execute successful\nInstallation is complete.\n\nPlease check the result using the command:\n\n\tkubectl logs -n kubesphere-system "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get pod -n kubesphere-system -l "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("app")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ks-install -o "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{.items[0].metadata.name}'")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" -f\n\nYou have mail "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /var/spool/mail/root\n")])])]),e("p",[s._v("根据输出的账号密码 "),e("code",[s._v("amdin/P@88w0rd")]),s._v(" 使用公网IP登录到web控制台：")]),s._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),e("p",[s._v("记住打开防火墙的端口 30880，我在青云的安全组里开放了k8s的30000-32767端口：")]),s._v(" "),e("p",[e("img",{attrs:{src:"http://img.zhoubg.cn/static/image-20220516154024269.png",alt:"image-20220516154024269"}})])]),s._v(" "),e("p",[e("img",{attrs:{src:"http://img.zhoubg.cn/static/image-20220516143537128.png",alt:"image-20220516143537128"}})]),s._v(" "),e("p",[e("img",{attrs:{src:"http://img.zhoubg.cn/static/image-20220516143709785.png",alt:"image-20220516143709785"}})]),s._v(" "),e("p",[s._v('点击"平台管理"可以看到一下模块：集群管理、访问控制、平台设置')]),s._v(" "),e("p",[e("img",{attrs:{src:"http://img.zhoubg.cn/static/image-20220516143743101.png",alt:"image-20220516143743101"}})]),s._v(" "),e("p",[s._v("集群管理：")]),s._v(" "),e("p",[e("img",{attrs:{src:"http://img.zhoubg.cn/static/image-20220516145401638.png",alt:"image-20220516145401638"}})]),s._v(" "),e("p",[s._v("访问控制：")]),s._v(" "),e("p",[e("img",{attrs:{src:"http://img.zhoubg.cn/static/image-20220516145437578.png",alt:"image-20220516145437578"}})]),s._v(" "),e("p",[s._v("平台设置：")]),s._v(" "),e("p",[e("img",{attrs:{src:"http://img.zhoubg.cn/static/image-20220516145503125.png",alt:"image-20220516145503125"}})]),s._v(" "),e("h3",{attrs:{id:"_3、安装后开启其他功能"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3、安装后开启其他功能"}},[s._v("#")]),s._v(" 3、安装后开启其他功能")]),s._v(" "),e("p",[s._v("可以通过修改集群配置文件"),e("code",[s._v("ClusterConfiguration")]),s._v("来开启其他功能")]),s._v(" "),e("p",[e("img",{attrs:{src:"http://img.zhoubg.cn/static/image-20220516152729433.png",alt:"image-20220516152729433"}})]),s._v(" "),e("p",[s._v("进入配置文件详情，编辑YAML：")]),s._v(" "),e("p",[e("img",{attrs:{src:"http://img.zhoubg.cn/static/image-20220516152833161.png",alt:"image-20220516152833161"}})]),s._v(" "),e("p",[s._v("比如我们通过修改"),e("code",[s._v("devops.enabled=true")]),s._v("开开启 devops 持续集成功能，修改"),e("code",[s._v("events.enabled=ture")]),s._v("开启事件功能")]),s._v(" "),e("p",[e("img",{attrs:{src:"http://img.zhoubg.cn/static/image-20220516153319149.png",alt:"image-20220516153319149"}})]),s._v(" "),e("h3",{attrs:{id:"_4、使用命令查看安装了哪些pod"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4、使用命令查看安装了哪些pod"}},[s._v("#")]),s._v(" 4、使用命令查看安装了哪些Pod")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod -A")]),s._v("\nNAMESPACE                      NAME                                               READY   STATUS    RESTARTS   AGE\nkube-system                    calico-kube-controllers-75ddb95444-nz9km           "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("          4d17h\nkube-system                    calico-node-66xpz                                  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("          4d17h\nkube-system                    coredns-5495dd7c88-bg44v                           "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("          4d17h\nkube-system                    coredns-5495dd7c88-k6g48                           "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("          4d17h\nkube-system                    kube-apiserver-k8s-master                          "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("          4d17h\nkube-system                    kube-controller-manager-k8s-master                 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("          4d17h\nkube-system                    kube-proxy-4997d                                   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("          4d17h\nkube-system                    kube-scheduler-k8s-master                          "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("          4d17h\nkube-system                    nodelocaldns-mcpdd                                 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("          4d17h\nkube-system                    openebs-localpv-provisioner-6c9dcb5c54-x2gdx       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("          4d17h\nkube-system                    snapshot-controller-0                              "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("          4d17h\nkubesphere-controls-system     default-http-backend-5bf68ff9b8-k48qh              "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("          4d17h\nkubesphere-controls-system     kubectl-admin-6667774bb-5hhll                      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("          4d17h\nkubesphere-monitoring-system   alertmanager-main-0                                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("          4d17h\nkubesphere-monitoring-system   kube-state-metrics-5547ddd4cc-4l4d7                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("/3     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("          4d17h\nkubesphere-monitoring-system   node-exporter-654sb                                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("          4d17h\nkubesphere-monitoring-system   notification-manager-deployment-78664576cb-6fw5x   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("          4d17h\nkubesphere-monitoring-system   notification-manager-operator-7d44854f54-mgzzj     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("          4d17h\nkubesphere-monitoring-system   prometheus-k8s-0                                   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("          4d17h\nkubesphere-monitoring-system   prometheus-operator-5c5db79546-ppdw5               "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("          4d17h\nkubesphere-system              ks-apiserver-7c6dc7fff9-bp6n2                      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          44m\nkubesphere-system              ks-console-65f4d44d88-rb7sx                        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("          4d17h\nkubesphere-system              ks-controller-manager-84ff9ccf66-44l8z             "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          44m\nkubesphere-system              ks-installer-69df988b79-gdfs5                      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("          4d17h\n")])])])])}),[],!1,null,null,null);t.default=a.exports}}]);